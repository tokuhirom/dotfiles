#!/bin/bash
FARM_INFO_URL=http://dav.navercorp.jp/data/facility/pmc.farm.active.info

function ss-farm-list() {
    curl -s $FARM_INFO_URL
}

function ss-farm-servers() {
    if [[ $# -lt 1 ]]; then
        echo "Usage: ss-farm-list FARM"
        return
    fi

    FARM=$1
    ss-farm-list | egrep "^$FARM\t" | awk '{print $2}'
}

function ssline() {
    if [[ $# -eq 1 ]]; then
        local host=$1
    else
        tmpfile=$(mktemp /tmp/ssline.XXXXXX)
        awk '{print $1 " " $1}' < ~/.itsc-servers > $tmpfile

        ss-farm-list | egrep 'cms|dmp|taxi|jrr|biz|connector|ansible|sticker|poi|bot-dispatcher|notify|switcher|adp|redirect|lad|lass|lasm|kakyoin' >> $tmpfile

        local host=$(cat $tmpfile | peco | awk '{print $2}')
        rm $tmpfile
    fi

    exec ss-login $host
}

ssline $*
